<!DOCTYPE HTML>
<html lang="">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="IMCSI">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>Lavaral使用（2） | IMCSI</title>


    <link rel="alternate" href="/atom.xml" title="IMCSI" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <h1 class="site-title"><a href="https://blog.ibeeasy.cn/" rel="home">iBeEasy</a></h1>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation"><a href="/"><i class="fa fa-fw "></i>首页</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/PHP/"><i class="fa fa-fw "></i>PHP</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/Linux/"><i class="fa fa-fw "></i>Linux</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/Mysql/"><i class="fa fa-fw "></i>Mysql</a>
                            </li>
                        
                            <li role="presentation"><a href="/about"><i class="fa fa-fw "></i>关于我</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Lavaral使用（2）">
            
	            Lavaral使用（2）
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/PHP">
            PHP
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a href="/tags/laravel">
               laravel
            </a>
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2018/03/23</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p>1.富文本编辑器（UEditor）<br>laravel的依赖管理工具composer中可以快速的帮助我们集成ueditor到框架中，配置过程：</p>
<p>在laravel项目根目录配置composer.json文件，在require中写入：</p>
<pre><code>&quot;stevenyangecho/laravel-u-editor&quot;: &quot;~1.4&quot;
</code></pre><p>然后在cmd模式下输入：composer update （需要将composer配置为全局变量）</p>
<pre><code>PS E:\wamp\www\blog&gt; composer update
Loading composer repositories with package information
Updating dependencies (including require-dev)
Package operations: 3 installs, 31 updates, 0 removals
 - Updating symfony/polyfill-mbstring (v1.6.0 =&gt; v1.7.0): Downloading (100%)
 - Updating symfony/var-dumper (v3.3.13 =&gt; v3.4.6): Downloading (100%)
 - Updating symfony/debug (v3.3.13 =&gt; v3.4.6): Downloading (100%)
.......//省略部分内容
Package manifest generated successfully.
</code></pre><p>更新完成之后，修改laravel的配置文件（config/app.php）:</p>
<p>在 “providers” 这个key 最后加上 ：</p>
<pre><code>Stevenyangecho\UEditor\UEditorServiceProvider::class
</code></pre><p>在”aliases” 这个key最后加上：</p>
<pre><code>&apos;UEditor&apos;=&gt;Stevenyangecho\UEditor\UEditorServiceProvider::class
</code></pre><p>配置完之后，命令提示符进入项目的根目录：</p>
<pre><code>PS E:\wamp\www&gt; cd blog
PS E:\wamp\www\blog&gt; php artisan vendor:publish


  [Symfony\Component\Debug\Exception\FatalThrowableError]
  Class &apos;Stevenyangecho\UEditor\UEditorServiceProvider&apos; not found
</code></pre><p>提示以上的错误要确定之前的步骤是否正确：</p>
<pre><code>PS E:\wamp\www\blog&gt; php artisan vendor:publish

 Which provider or tag&apos;s files would you like to publish?:
  [0 ] Publish files from all providers and tags listed below
.......
 &gt; 0//输入0

.......
Publishing complete.
</code></pre><p>出现以上信息说明已经配置完成。</p>
<p>一串文件下载配置之后，laravel项目的public目录下会自动建立一个laravel-u-editor的文件夹。这个文件夹里包含的是编辑器本身的JS文件。同时在config文件夹下也会生成一个名为UEditorUpload.php的文件，这个是基础的配置文件。当这些文件都生成之后，说明编辑器已经在项目中集成好了，下一步就可以在视图文件中进行注入了</p>
<p>前端视图中整合ue编辑器：</p>
<p>首先引入JS等文件，因为laravel框架已经帮我们集成好了，直接在视图文件尾部加入</p>
<p>@include(‘UEditor::head’) 即可</p>
<p>然后加载编辑器的容器，最后实例化编辑器，这部分比较简单，直接贴代码：</p>
<p> 加载编辑器的容器 </p>
<pre><code>&lt;div id=&quot;detail_info&quot;&gt;
&lt;script id=&quot;container&quot; name=&quot;content&quot; type=&quot;text/plain&quot; style=&quot;width: 900px;position:absolute;left:300px;top:120px;&quot;&gt;
{!! html_entity_decode($article-&gt;content) !!} //将富文本编辑器内容转义并在页面上显示
&lt;/script&gt;
</code></pre><p> 实例化编辑器 </p>
<pre><code>&lt;script&gt;

var ue = UE.getEditor(&apos;container&apos;);
ue.ready(function(){ 
ue.execCommand(&apos;serverparam&apos;, &apos;_token&apos;, &apos;{{ csrf_token() }}&apos;); //这里添加laravel安全token：便于数据提交
});
&lt;/script&gt;
</code></pre><p>2.表单验证<br>直接上代码：</p>
<pre><code>public function store(Request $request) {
    $data = $request-&gt;except(&apos;_token&apos;);//获取除token外的所有表单数据
    $this-&gt;validate($request, [//验证表单值
        &apos;title&apos; =&gt; &apos;requred&apos;,//设置title为必填
        &apos;content&apos; =&gt; &apos;integer&apos;,//设置content整数

    ], [
        &apos;required&apos; =&gt; &apos;:attribute 为必填项&apos;,//自定义提示文字，默认为英文
        &apos;min&apos; =&gt; &apos;:attribute 长度不符合要求&apos;,
        &apos;integer&apos; =&gt; &apos;:attribute 必须为整数&apos;,
    ], [
        &apos;title&apos; =&gt; &apos;标题&apos;,//设置表单字段表示的含义
        &apos;content&apos; =&gt; &apos;内容&apos;,
    ]);//当验证未通过则自动返回表单页面，不会执行以下内容
    $result = DB::table(&apos;news&apos;)
        -&gt;insert($data);//数据插入
    if ($result) {
        return redirect()-&gt;back()-&gt;with(&apos;msg&apos;, &apos;操作成功&apos;);//插入成功，返回添加页
    } else {
        return redirect()-&gt;back()-&gt;with(&apos;msg&apos;, &apos;操作失败&apos;)-&gt;withInput();//插入失败，返回添加页并提示错误，将原表单数据返回
    }
}
</code></pre><p>在页面上显示提示：</p>
<pre><code>@if (count($errors) &gt; 0)//$errors 变量在每次请求的所有视图中都可以被使用，你可以很方便的假设 $errors 变量已被定义且进行安全地使用。
  &lt;div class=&quot;alert alert-danger&quot;&gt;//验证未通过则返回错误信息
    &lt;ul&gt;
      @foreach ($errors-&gt;all() as $error)
        &lt;li&gt;{{ $error }}&lt;/li&gt;
      @endforeach
    &lt;/ul&gt;
  &lt;/div&gt;
@endif

&lt;fieldset&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label class=&quot;col-sm-2 control-label&quot;&gt;资讯标题&lt;/label&gt;
      {{session('success')}}//此处返回表单验证通过后闪存中session的信息
        &lt;div class=&quot;col-sm-6&quot;&gt;
            &lt;input value=&quot;{{old('title')}}&quot; class=&quot;form-control&quot; id=&quot;title&quot; type=&quot;text&quot; name=&quot;title&quot;  style=&quot;width:40%;&quot;/&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</code></pre><p>3.数据筛选和分页</p>
<pre><code>public function index(Request $request) {
    if ($request-&gt;input(&apos;category_id&apos;)) {//判断是否带有分类id
        $category_id = $request-&gt;input(&apos;category_id&apos;);//获取分类id
        if ($category_id == &apos;all&apos;) {//判断是否是所有分类
            $news = DB::table(&apos;news&apos;)
                -&gt;select(&apos;id&apos;, &apos;title&apos;, &apos;category_id&apos;, &apos;addtime&apos;)
                -&gt;orderBy(&quot;id&quot;, &quot;desc&quot;)
                -&gt;paginate(10);
        } else {//否则执行where查询单个分类
            $news = DB::table(&apos;news&apos;)
                -&gt;select(&apos;id&apos;, &apos;title&apos;, &apos;category_id&apos;, &apos;addtime&apos;)
                -&gt;where(&apos;category_id&apos;, $category_id)
                -&gt;orderBy(&quot;id&quot;, &quot;desc&quot;)
                -&gt;paginate(10);
        }
    } else {//不带分类id则默认加上，方便在分页里调用
        $news = DB::table(&apos;news&apos;)
            -&gt;select(&apos;id&apos;, &apos;title&apos;, &apos;category_id&apos;, &apos;addtime&apos;)
            -&gt;orderBy(&quot;id&quot;, &quot;desc&quot;)
            -&gt;paginate(10);
        $category_id = &apos;all&apos;;
    }

    $category = DB::table(&apos;category&apos;)
        -&gt;get();
    $assign = array(
        &apos;news&apos; =&gt; $news,
        &apos;category&apos; =&gt; $category,
        &apos;category_id&apos; =&gt; $category_id,//用于记住分类id
    );
    return view(&apos;admin.news.index&apos;, $assign);
}
</code></pre><p>重点在于：</p>
<p>默认的分页展示写法是这样的：</p>
<pre><code>{!! $news-&gt;links() !!}
</code></pre><p>那么当分页筛选成功后，点击下一页则无法按照条件筛选，因为category_id没有存入到分页的url。我们需要将分类id加入到分页url中才能记住用户选择的分类id：</p>
<pre><code>{!! $news-&gt;appends(array(&apos;category_id&apos;=&gt;$category_id))-&gt;links() !!}
</code></pre><p>那么生成的分页url是这样的：</p>
<pre><code>http://www.blog.com/admin/news/index?category_id=1&amp;page=2
</code></pre><p>就能记住用户选择的分类id进行where条件筛选。</p>

    </div>

    <div class="post-footer">   
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
        </div>
        <div>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2018/03/23/Lavaral使用（3）/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/2018/03/23/Lavaral使用（1）/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
	<!--PC和WAP自适应版-->
<div id="SOHUCS"></div>
<script type="text/javascript">
	(function(){var appid='cyt8KmUC1';var conf='prod_855a68d3b3d91855360a6215672a505a';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>');}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
	c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});}})();
</script>	

    </div>





                </main>
                
    <aside class="col-md-4 sidebar">
        
        
    <div class="widget">    
        <h3 class="title">搜索</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">站内搜索</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>

        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            
内容源自原网站<a href="https://blog.ibeeasy.cn" title="fork me" target="_blank">iBeEasy</a> <br/>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">社交</h3> 
        <div class="content social">
            
	            <a href="https://github.com/1172426418" rel="external nofollow" title="Github" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="mailto:1172426418@qq.com" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="1172426418" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="/atom.xml" rel="external nofollow" title="RSS" target="_blank">
			    	<i class="feed fa fa-feed"></i>
			    </a>
            
        </div>
    </div>


        
        
    <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/"><i class="fa" aria-hidden="true">Linux</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/"><i class="fa" aria-hidden="true">Mysql</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/"><i class="fa" aria-hidden="true">PHP</i></a><span class="category-list-count">9</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/"><i class="fa" aria-hidden="true">March 2018</i></a><span class="archive-list-count">15</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
        <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/UEditor/" style="font-size: 10px;">UEditor</a> <a href="/tags/ajax/" style="font-size: 10px;">ajax</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/debugbar/" style="font-size: 10px;">debugbar</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/laravel/" style="font-size: 20px;">laravel</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/mysql-nginx-php/" style="font-size: 10px;">mysql nginx php</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/tp/" style="font-size: 10px;">tp</a> <a href="/tags/上传/" style="font-size: 10px;">上传</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/模板继承/" style="font-size: 10px;">模板继承</a> <a href="/tags/登陆验证/" style="font-size: 10px;">登陆验证</a> <a href="/tags/表单验证/" style="font-size: 10px;">表单验证</a> <a href="/tags/递归-php/" style="font-size: 10px;">递归 php</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">友链</h3>
        <div class="content friends-link">
        
            <a href="http://www.shenliyang.com" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>